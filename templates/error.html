{% extends 'base.html' %}

{% block title %}ì§€ëª© ì˜¤ë¥˜ - Withinstar{% endblock %}

{% block content %}
<div class="main-content">
    <div class="error-container">
        <div class="error-box">
            <h1 class="error-title" style="color: #d9534f;" 
                data-lang-eng="Error occurred! Matching failed." 
                data-lang-kor="ì˜¤ë¥˜ ë°œìƒ! ë§¤ì¹­ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.">
                ì˜¤ë¥˜ ë°œìƒ! ë§¤ì¹­ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.
            </h1>
            <p class="error-message" style="color: #d9534f;" 
               data-lang-eng="Only one person can be selected. If you want to select additional people, please proceed with payment." 
               data-lang-kor="í•œ ëª…ë§Œ ì§€ëª© ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¶”ê°€ ì§€ëª©ì„ ì›í•˜ì‹œë©´ ê²°ì œë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.">
                í•œ ëª…ë§Œ ì§€ëª© ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¶”ê°€ ì§€ëª©ì„ ì›í•˜ì‹œë©´ ê²°ì œë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.
            </p>
            <p class="error-info" style="color: #333;" 
               data-lang-eng="â¤ï¸ 'Would you like to express additional interest?'<br>If you express additional interest, a fee of <strong style='color: #d9534f;'>2,500 KRW per attempt</strong> will be charged.<br>Share your feelings secretly with <strong>Withinstar</strong>!"
               data-lang-kor="â¤ï¸ 'ì¶”ê°€ ì§€ëª©ì„ ì›í•˜ì‹œë‚˜ìš”?'<br>ì´í›„ ì¶”ê°€ë¡œ ê´€ì‹¬ì„ í‘œí˜„í•˜ì‹¤ ê²½ìš°, <strong style='color: #d9534f;'>1íšŒë‹¹ 2,500ì›</strong>ì˜ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.<br>ë¹„ë°€ìŠ¤ëŸ½ê²Œ ë§ˆìŒì„ ì „í•˜ëŠ” <strong>Withinstar</strong>ì™€ í•¨ê»˜í•˜ì„¸ìš”!">
                â¤ï¸ 'ì¶”ê°€ ì§€ëª©ì„ ì›í•˜ì‹œë‚˜ìš”?'<br>
                ì´í›„ ì¶”ê°€ë¡œ ê´€ì‹¬ì„ í‘œí˜„í•˜ì‹¤ ê²½ìš°, <strong style="color: #d9534f;">1íšŒë‹¹ 2,500ì›</strong>ì˜ ìš”ê¸ˆì´ ë¶€ê³¼ë©ë‹ˆë‹¤.<br>
                ë¹„ë°€ìŠ¤ëŸ½ê²Œ ë§ˆìŒì„ ì „í•˜ëŠ” <strong>Withinstar</strong>ì™€ í•¨ê»˜í•˜ì„¸ìš”!
            </p>
            <button class="error-button" id="openPopup" style="background-color: #d9534f;" 
                onclick="gtag('event', 'pay_2500_oferror');" 
                data-lang-eng="Express Feelings" 
                data-lang-kor="ë§ˆìŒ ì „ë‹¬í•˜ê¸°">
                ë§ˆìŒ ì „ë‹¬í•˜ê¸°
            </button>
            <hr class="divider" style="border: 1px solid #f5c6cb; margin: 10px 0;">
            <p style="color: #555;" 
               data-lang-eng="Alternatively, you can delete the existing registration and select a new person." 
               data-lang-kor="í˜¹ì€, ê¸°ì¡´ì˜ ë“±ë¡ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œìš´ ì‚¬ëŒì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">
                í˜¹ì€, ê¸°ì¡´ì˜ ë“±ë¡ì„ ì‚­ì œí•˜ê³  ìƒˆë¡œìš´ ì‚¬ëŒì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </p>
            <input type="hidden" id="encryptedID" value="{{ encrypted_id }}">
            <button id="changeTargetButton" style="background-color: #5bc0de;" 
                onclick="gtag('event', 'exchange_id');" 
                data-lang-eng="Change Registered Target" 
                data-lang-kor="ë“±ë¡í•œ ìƒëŒ€ ë°”ê¾¸ê¸°">
                ë“±ë¡í•œ ìƒëŒ€ ë°”ê¾¸ê¸°
            </button>
            <hr class="divider" style="border: 1px solid #f5c6cb; margin: 10px 0;">
            <h2 class="features-title" style="color: #333;" 
                data-lang-eng="Service Features" 
                data-lang-kor="ì„œë¹„ìŠ¤ íŠ¹ì§•">
                ì„œë¹„ìŠ¤ íŠ¹ì§•
            </h2>
            <ul class="features-list" style="list-style: none; padding: 0; color: #555; font-size: 0.8rem; line-height: 1.8; margin-bottom: 20px;">
                <li data-lang-eng="ğŸ”’ Your information will never be disclosed thanks to our encryption system."
                    data-lang-kor="ğŸ”’ ì•”í˜¸í™” ì‹œìŠ¤í…œìœ¼ë¡œ ì •ë³´ê°€ ì ˆëŒ€ ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.">
                    ğŸ”’ ì•”í˜¸í™” ì‹œìŠ¤í…œìœ¼ë¡œ ì •ë³´ê°€ ì ˆëŒ€ ê³µê°œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </li>
                <li data-lang-eng="ğŸ“© Receive an instant notification via Instagram DM when matched!"
                    data-lang-kor="ğŸ“© ìƒëŒ€ë°©ê³¼ ë§¤ì¹­ ì„±ê³µ ì‹œ Instagram DMìœ¼ë¡œ ë°”ë¡œ ì•Œë¦¼!">
                    ğŸ“© ìƒëŒ€ë°©ê³¼ ë§¤ì¹­ ì„±ê³µ ì‹œ Instagram DMìœ¼ë¡œ ë°”ë¡œ ì•Œë¦¼!
                </li>
                <li data-lang-eng="ğŸ’Œ Experience a simple and intuitive way to express your feelings."
                    data-lang-kor="ğŸ’Œ ë§ˆìŒì„ ì „í•˜ëŠ” ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ê²½í—˜í•˜ì„¸ìš”.">
                    ğŸ’Œ ë§ˆìŒì„ ì „í•˜ëŠ” ê°„ë‹¨í•˜ê³  ì§ê´€ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ê²½í—˜í•˜ì„¸ìš”.
                </li>
            </ul>
            <div style="text-align: center;">
                <a href="/" class="home-link" style="color: #d9534f; text-decoration: none; font-size: 0.8rem; padding-top: 20px; display: inline-block;"
                   data-lang-eng="Go back to Home" 
                   data-lang-kor="í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°">
                    í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>
</div>

<div id="popup" class="popup" style="display: none;">
    <div class="popup-content">
        <h2 data-lang-eng="Feature Under Development" 
            data-lang-kor="ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘">
            ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘
        </h2>
        <p data-lang-eng="'Express Feelings' is under development.<br>However, free matching works properly.<br>Please wait! We'll deliver better services. ğŸ˜Š"
           data-lang-kor="'ë§ˆìŒ ì „ë‹¬í•˜ê¸°' ê¸°ëŠ¥ì€ í˜„ì¬ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.<br>í•˜ì§€ë§Œ ë¬´ë£Œ ë§¤ì¹­ì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.<br>ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”! ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤. ğŸ˜Š">
            'ë§ˆìŒ ì „ë‹¬í•˜ê¸°' ê¸°ëŠ¥ì€ í˜„ì¬ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤.<br>
            í•˜ì§€ë§Œ ë¬´ë£Œ ë§¤ì¹­ì€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.<br>
            ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”! ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤. ğŸ˜Š
        </p>
        <button id="closePopup" class="popup-button" 
            data-lang-eng="Close" 
            data-lang-kor="ë‹«ê¸°">
            ë‹«ê¸°
        </button>
    </div>
</div>

{% block scripts %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
    const openPopupButton = document.getElementById("openPopup");
    const popup = document.getElementById("popup");
    const closePopupButton = document.getElementById("closePopup");
    const changeTargetButton = document.getElementById("changeTargetButton");

    // íŒì—… ì—´ê¸°
    if (openPopupButton) {
        openPopupButton.addEventListener("click", function () {
            popup.style.display = "flex"; // íŒì—… í‘œì‹œ
        });
    }

    // íŒì—… ë‹«ê¸°
    if (closePopupButton) {
        closePopupButton.addEventListener("click", function () {
            popup.style.display = "none"; // íŒì—… ìˆ¨ê¹€
        });
    }

    // ê¸°ì¡´ ëŒ€ìƒ ë³€ê²½ ìš”ì²­
    if (changeTargetButton) {
        const handleChangeTarget = async () => {
            if (changeTargetButton.disabled) return; // ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì´ë¼ë©´ ìš”ì²­ ì¤‘ë³µ ë°©ì§€
            changeTargetButton.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”

            const encryptedID = document.getElementById("encryptedID").value;
            console.log("ì‚­ì œ ìš”ì²­ ì „ì†¡ ì‹œì‘"); // ë””ë²„ê¹… ë¡œê·¸

            try {
                const response = await fetch('/delete_target', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ encryptedID }),
                });

                const result = await response.json();
                console.log("ì‘ë‹µ ìˆ˜ì‹ :", result); // ë””ë²„ê¹… ë¡œê·¸

                if (result.message) {
                    alert(result.message);
                    window.location.href = '/'; // í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                } else if (result.error) {
                    alert(result.error);
                }
            } catch (error) {
                console.error("ì˜¤ë¥˜ ë°œìƒ:", error); // ë””ë²„ê¹… ë¡œê·¸
                alert('ì‚­ì œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                changeTargetButton.disabled = false; // ë²„íŠ¼ í™œì„±í™”
            }
        };

        // ê¸°ì¡´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì œê±° í›„ ë“±ë¡
        changeTargetButton.removeEventListener("click", handleChangeTarget);
        changeTargetButton.addEventListener("click", handleChangeTarget);
    }
});
</script>
{% endblock %}
{% endblock %}