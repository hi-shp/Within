<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오류 발생</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="/static/css/style.css?v=2">
</head>
<body>
    <!-- 헤더 -->
    <header class="header">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='images/logo1.png') }}" alt="Withinstar Logo" class="logo">
            <span class="site-name">Withinstar.com</span>
        </div>
    </header>

    <div class="page-container">
        <!-- 좌측 광고 -->
        <div class="ad-section ad-left">
            <div class="adsense">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4209969470096098"
                    crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                    style="display:block"
                    data-ad-client="ca-pub-4209969470096098"
                    data-ad-slot="1234567890"
                    data-ad-format="auto"
                    data-full-width-responsive="true"></ins>
                <script>+
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>

        <!-- 메인 콘텐츠 -->
        <div class="main-content">
            <div class="error-container">
                <div class="error-box">
                    <h1 class="error-title" style="color: #d9534f;">오류 발생! 매칭이 실패했습니다.</h1>
                    <p class="error-message" style="color: #d9534f;">한 명만 지목 가능합니다. 추가 지목을 원하시면 결제를 진행해주세요.</p>
                    <p class="error-info" style="color: #333;">
                        ❤️ "추가 지목을 원하시나요?"<br>
                        이후 추가로 관심을 표현하실 경우, <strong style="color: #d9534f;">1회당 2,500원</strong>의 요금이 부과됩니다.<br>
                        비밀스럽게 마음을 전하는 <strong>Withinstar</strong>와 함께하세요!
                    </p>
                    <button class="error-button" id="openPopup" style="background-color: #d9534f;">마음 전달하기</button>
                    <hr class="divider" style="border: 1px solid #f5c6cb; margin: 10px 0;">
                    <p style="color: #555;">
                        혹은, 기존의 등록을 삭제하고 새로운 사람을 선택할 수 있습니다.
                    </p>
                    <a id="changeTargetButton" href="/" style="text-decoration: none;">
                        <button style="background-color: #5bc0de;">등록한 상대 바꾸기</button>
                    </a>                    

                    <hr class="divider" style="border: 1px solid #f5c6cb; margin: 10px 0;">
                    <h2 class="features-title" style="color: #333;">서비스 특징</h2>
                    <ul class="features-list" style="list-style: none; padding: 0; color: #555; font-size: 0.8rem; line-height: 1.8; margin-bottom: 20px;">
                        <li>🔒 암호화 시스템으로 정보가 절대 공개되지 않습니다.</li>
                        <li>📩 상대방과 매칭 성공 시 Instagram DM으로 바로 알림!</li>
                        <li>💌 마음을 전하는 간단하고 직관적인 서비스를 경험하세요.</li>
                    </ul>
                    <div style="text-align: center;">
                        <a href="/" class="home-link" style="color: #d9534f; text-decoration: none; font-size: 0.8rem; padding-top: 20px; display: inline-block;">
                            홈으로 돌아가기
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 우측 광고 -->
        <div class="ad-section ad-right">
            <div class="adsense">
                <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4209969470096098"
                    crossorigin="anonymous"></script>
                <ins class="adsbygoogle"
                    style="display:block"
                    data-ad-client="ca-pub-4209969470096098"
                    data-ad-slot="1234567890"
                    data-ad-format="auto"
                    data-full-width-responsive="true"></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
    </div>

    <!-- 팝업 레이아웃 -->
    <div id="popup" class="popup" style="display: none;">
        <div class="popup-content">
            <h2>기능 준비 중</h2>
            <p>
                "마음 전달하기" 기능은 현재 구현 중입니다.<br>
                하지만 무료 매칭은 정상적으로 작동합니다.<br>
                조금만 기다려 주세요! 더 나은 서비스를 제공하겠습니다. 😊
            </p>
            <button id="closePopup" class="popup-button">닫기</button>
        </div>
    </div>    

    <!-- 푸터 -->
    <footer class="footer">
        <div class="footer-content">
            <p>© 2024 썸데이(Withinstar). All rights reserved.</p>
            <p>사업자 등록번호: 843-18-02055 | 대표: 박순홍</p>
            <p>이메일: hishp@pusan.ac.kr | 전화: 010-5278-4017</p>
            <p>주소: 부산광역시 금정구 부산대학로63번길 (부산대학교 11공학관)</p>
            <p>본 웹사이트의 모든 콘텐츠는 저작권법에 의해 보호되며, 무단 복제 및 배포를 금합니다.</p>
        </div>
    </footer>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
    const openPopupButton = document.getElementById("openPopup");
    const popup = document.getElementById("popup");
    const closePopupButton = document.getElementById("closePopup");
    const changeTargetButton = document.getElementById("changeTargetButton");

    // 팝업 열기 (마음 전달하기 버튼 클릭 시 팝업 표시)
    if (openPopupButton) {
        openPopupButton.addEventListener("click", function () {
            popup.style.display = "flex"; // 팝업 표시
        });
    }

    // 팝업 닫기
    if (closePopupButton) {
        closePopupButton.addEventListener("click", function () {
            popup.style.display = "none"; // 팝업 숨김
        });
    }

    // 등록한 상대 바꾸기 버튼 클릭 이벤트
    if (changeTargetButton) {
        changeTargetButton.addEventListener("click", async function (event) {
            event.preventDefault(); // 기본 동작(링크 이동) 중단

            try {
                // DELETE 요청으로 서버에 데이터 삭제 요청
                const response = await fetch('/delete_target', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(result.message); // 성공 메시지 표시
                    window.location.href = "/"; // 홈 화면으로 리다이렉션
                } else if (response.status === 401) {
                    alert("인증되지 않은 사용자입니다. 다시 로그인해주세요.");
                    window.location.href = "/error/User not authenticated"; // 오류 페이지로 이동
                } else if (response.status === 404) {
                    alert("삭제할 대상이 없습니다.");
                } else {
                    alert("오류가 발생했습니다. 다시 시도해주세요.");
                }
            } catch (error) {
                alert("네트워크 오류가 발생했습니다. 다시 시도해주세요.");
                console.error("Error:", error);
            }
        });
    }
});

</script>        
</body>
</html>
