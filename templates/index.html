{% extends 'base.html' %}

{% block title %}
Withinstar - Instagram ID 등록
{% endblock %}

{% block content %}
<!-- 후킹 멘트 -->
<div class="hook-section">
    <h1>“팔로우는 했는데, DM은 어떻게 보낼지 망설이셨나요?”</h1>
    <p>
        혹시나 내가 관심 있다는 사실이 주변에 알려질까 두렵진 않으셨나요?<br>
        과에서 소문이라도 날까 걱정되셨다면, 이제는 <strong>Withinstar</strong>를 이용해 보세요!<br>
        관심을 표현하고 싶지만 선뜻 용기 내기 어려운 그 순간, 저희가 도와드립니다.
    </p>
</div>

<!-- 서비스 과정 및 입력 폼 -->
<div class="intro-section">
    <h2>서비스 이용 방법</h2>
    <ol>
        <li>나의 Instagram ID와 관심 있는 상대방의 ID를 입력합니다.</li>
        <li>입력한 정보는 안전하게 암호화되어 서버에 저장됩니다.</li>
        <li>상대방도 동일한 방식으로 관심을 표현할 경우에만 매칭이 성사됩니다.</li>
        <li>매칭이 성공하면 Instagram DM을 통해 서로에게 알림이 발송됩니다.</li>
    </ol>
</div>
<div class="container">
    <h2>Instagram ID 등록</h2>
    <form id="instagramForm">
        <label for="userInstagramID">나의 Instagram ID:</label>
        <input type="text" id="userInstagramID" name="userInstagramID" required>

        <label for="targetInstagramID">상대방 Instagram ID:</label>
        <input type="text" id="targetInstagramID" name="targetInstagramID" required>

        <button type="submit" onclick="gtag('event', 'submit');">등록하기</button>
    </form>
    <p id="message"></p>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('instagramForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        const userInstagramID = document.getElementById('userInstagramID').value;
        const targetInstagramID = document.getElementById('targetInstagramID').value;

        try {
            const response = await fetch('/save_instagram_id', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    userInstagramID: userInstagramID,
                    targetInstagramID: targetInstagramID
                })
            });

            const result = await response.json();

            if (result.redirect) {
                window.location.href = result.redirect;
            }
        } catch (error) {
            alert('스스로를 사랑하시는군요!');
        }
    });
</script>
{% endblock %}
